name: Sync hosted-mcp to Fork

on:
  push:
    branches:
      - hosted-mcp
  workflow_dispatch: # Allow manual triggering

jobs:
  sync-to-fork:
    runs-on: ubuntu-latest

    steps:
      - name: Trigger fork merge via API
        env:
          GH_TOKEN: ${{ secrets.FORK_SYNC_TOKEN }}
        run: |
          # Merge hosted-mcp into main on the fork using GitHub API
          curl -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.FORK_SYNC_TOKEN }}" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            https://api.github.com/repos/mustavikhan05/VibeMini-MCP/merges \
            -d '{
              "base": "main",
              "head": "hosted-mcp",
              "commit_message": "Auto-sync: Merge hosted-mcp from upstream\n\nThis automatically syncs changes from milab-nsu/VibeMini-MCP hosted-mcp branch to the fork'\''s main branch for FastMCP Cloud deployment.\n\nðŸ¤– Automated by GitHub Actions"
            }'
